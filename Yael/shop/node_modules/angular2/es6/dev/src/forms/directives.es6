import {Directive} from 'angular2/src/core/annotations_impl/annotations';
import {Ancestor} from 'angular2/src/core/annotations_impl/visibility';
import {ElementRef} from 'angular2/src/core/compiler/element_ref';
import {Optional} from 'angular2/src/di/annotations_impl';
import {Renderer} from 'angular2/src/render/api';
import {isPresent,
  isString,
  CONST_EXPR,
  isBlank,
  BaseException} from 'angular2/src/facade/lang';
import {ListWrapper} from 'angular2/src/facade/collection';
import {ControlGroup,
  Control,
  isControl} from './model';
import {Validators} from './validators';
function _lookupControl(groupDirective, controlOrName) {
  if (isControl(controlOrName)) {
    return controlOrName;
  }
  if (isBlank(groupDirective)) {
    throw new BaseException(`No control group found for "${controlOrName}"`);
  }
  var control = groupDirective.findControl(controlOrName);
  if (isBlank(control)) {
    throw new BaseException(`Cannot find control "${controlOrName}"`);
  }
  return control;
}
Object.defineProperty(_lookupControl, "parameters", {get: function() {
    return [[ControlGroupDirective], [assert.type.any]];
  }});
export class DefaultValueAccessor {
  constructor() {
    this.onChange = (_) => {};
  }
  writeValue(value) {
    this.value = value;
  }
}
Object.defineProperty(DefaultValueAccessor, "annotations", {get: function() {
    return [new Directive({
      selector: '[control]',
      hostListeners: {
        'change': 'onChange($event.target.value)',
        'input': 'onChange($event.target.value)'
      },
      hostProperties: {'value': 'value'}
    })];
  }});
export class CheckboxControlValueAccessor {
  constructor(cd, elementRef, renderer) {
    this.onChange = (_) => {};
    this._elementRef = elementRef;
    this._renderer = renderer;
    cd.valueAccessor = this;
  }
  writeValue(value) {
    this._renderer.setElementProperty(this._elementRef.parentView.render, this._elementRef.boundElementIndex, 'checked', value);
  }
}
Object.defineProperty(CheckboxControlValueAccessor, "annotations", {get: function() {
    return [new Directive({
      selector: 'input[type=checkbox][control]',
      hostListeners: {'change': 'onChange($event.target.checked)'},
      hostProperties: {'checked': 'checked'}
    })];
  }});
Object.defineProperty(CheckboxControlValueAccessor, "parameters", {get: function() {
    return [[ControlDirective], [ElementRef], [Renderer]];
  }});
export class ControlDirective {
  constructor(groupDirective, valueAccessor) {
    this._groupDirective = groupDirective;
    this._controlOrName = null;
    this.valueAccessor = valueAccessor;
    this.validator = Validators.nullValidator;
  }
  set controlOrName(controlOrName) {
    this._controlOrName = controlOrName;
    if (isPresent(this._groupDirective)) {
      this._groupDirective.addDirective(this);
    }
    var c = this._control();
    c.validator = Validators.compose([c.validator, this.validator]);
    this._updateDomValue();
    this._setUpUpdateControlValue();
  }
  _updateDomValue() {
    this.valueAccessor.writeValue(this._control().value);
  }
  _setUpUpdateControlValue() {
    this.valueAccessor.onChange = (newValue) => this._control().updateValue(newValue);
  }
  _control() {
    return _lookupControl(this._groupDirective, this._controlOrName);
  }
}
Object.defineProperty(ControlDirective, "annotations", {get: function() {
    return [new Directive({
      selector: '[control]',
      properties: {'controlOrName': 'control'}
    })];
  }});
Object.defineProperty(ControlDirective, "parameters", {get: function() {
    return [[ControlGroupDirective, new Optional(), new Ancestor()], [DefaultValueAccessor]];
  }});
export class ControlGroupDirective {
  constructor(groupDirective) {
    this._groupDirective = groupDirective;
    this._directives = ListWrapper.create();
  }
  set controlOrName(controlOrName) {
    this._controlOrName = controlOrName;
    this._updateDomValue();
  }
  _updateDomValue() {
    ListWrapper.forEach(this._directives, (cd) => cd._updateDomValue());
  }
  addDirective(c) {
    ListWrapper.push(this._directives, c);
  }
  findControl(name) {
    return this._getControlGroup().controls[name];
  }
  _getControlGroup() {
    return _lookupControl(this._groupDirective, this._controlOrName);
  }
}
Object.defineProperty(ControlGroupDirective, "annotations", {get: function() {
    return [new Directive({
      selector: '[control-group]',
      properties: {'controlOrName': 'control-group'}
    })];
  }});
Object.defineProperty(ControlGroupDirective, "parameters", {get: function() {
    return [[ControlGroupDirective, new Optional(), new Ancestor()]];
  }});
Object.defineProperty(ControlGroupDirective.prototype.addDirective, "parameters", {get: function() {
    return [[ControlDirective]];
  }});
Object.defineProperty(ControlGroupDirective.prototype.findControl, "parameters", {get: function() {
    return [[assert.type.string]];
  }});
export const formDirectives = CONST_EXPR([ControlGroupDirective, ControlDirective, CheckboxControlValueAccessor, DefaultValueAccessor]);
//# sourceMappingURL=directives.js.map

//# sourceMappingURL=./directives.map